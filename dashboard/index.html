<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2D68FF">
    <meta name="description" content="Visual analytics reports for git commit history">
    <!-- manifest injected by vite-plugin-pwa -->
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
    <title>Git Analytics Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;500;600&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="./styles.css">
</head>
<body class="min-h-screen">
    <div id="app" class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-themed-primary" id="repo-name">Git Analytics Dashboard</h1>
                    <p class="text-themed-tertiary mt-1" id="repo-subtitle">Loading data...</p>
                </div>
                <div id="export-buttons" class="hidden flex items-center gap-2 no-print">
                    <button id="btn-settings" class="btn-theme" title="Settings" aria-label="Settings">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                        </svg>
                    </button>
                    <button id="btn-sanitize" class="btn-theme" title="Toggle private mode (hide names/messages)" aria-label="Toggle private mode">
                        <svg id="icon-eye" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.64 0 8.577 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.64 0-8.577-3.007-9.963-7.178z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        <svg id="icon-eye-slash" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="hidden">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" />
                        </svg>
                    </button>
                    <!-- Theme toggle hidden: dark theme is dark-only -->
                    <button id="btn-theme" class="btn-theme hidden" title="Toggle dark mode">
                        <svg id="icon-sun" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="hidden">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
                        </svg>
                        <svg id="icon-moon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                        </svg>
                    </button>
                    <button id="btn-share" class="btn-icon btn-secondary" title="Copy shareable link" aria-label="Copy shareable link">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244" />
                        </svg>
                        <span class="hidden sm:inline">Share</span>
                    </button>
                    <button id="btn-pwa-install" class="btn-icon btn-secondary hidden" title="Install app" aria-label="Install app" onclick="installPWA()">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15M9 12l3 3m0 0 3-3m-3 3V2.25" />
                        </svg>
                        Install
                    </button>
                    <button id="btn-export-pdf" class="btn-icon btn-primary" title="Export as PDF" aria-label="Export as PDF">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                        </svg>
                        PDF
                    </button>
                </div>
            </div>
        </header>

        <!-- Data Loader -->
        <div id="loader" class="card text-center py-12">
            <div id="loader-content">
                <div id="drop-zone" class="drop-zone" tabindex="0" role="button" aria-label="Click or drag files to load data">
                    <svg class="drop-zone-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m6.75 12-3-3m0 0-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                    </svg>
                    <p class="text-themed-secondary font-medium">Drop JSON file(s) here or click to browse</p>
                    <p class="text-sm text-themed-muted mt-1">Select multiple files to combine data from different repositories</p>
                </div>
                <input type="file" id="file-input" accept=".json" multiple class="hidden">
                <p class="text-xs text-themed-muted mt-3">Or place your data.json in the same directory for auto-loading</p>
            </div>
            <div id="loader-spinner" class="hidden">
                <div class="loading-spinner mb-3"></div>
                <p class="text-themed-tertiary">Loading dashboard data...</p>
            </div>
        </div>

        <!-- Dashboard Content (hidden until data loads) -->
        <div id="dashboard" class="hidden">
            <!-- Sticky Tabs Bar -->
            <div class="tabs-bar">
                <div class="flex items-center gap-2 py-2">
                    <button id="filter-toggle" class="filter-toggle relative no-print" title="Toggle filters" aria-label="Toggle filters">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" />
                        </svg>
                        <span id="filter-badge" class="filter-badge hidden"></span>
                    </button>
                    <div class="flex overflow-x-auto scrollbar-hide flex-1 min-w-0">
                        <button class="tab-btn px-4 py-2 text-sm font-medium border-b-2 border-blue-500 text-blue-600 whitespace-nowrap flex-shrink-0" data-tab="overview">Overview</button>
                        <button class="tab-btn px-4 py-2 text-sm font-medium border-b-2 border-transparent text-themed-tertiary hover:text-themed-secondary whitespace-nowrap flex-shrink-0" data-tab="activity">Activity</button>
                        <button class="tab-btn px-4 py-2 text-sm font-medium border-b-2 border-transparent text-themed-tertiary hover:text-themed-secondary whitespace-nowrap flex-shrink-0" data-tab="work">Work</button>
                        <button class="tab-btn px-4 py-2 text-sm font-medium border-b-2 border-transparent text-themed-tertiary hover:text-themed-secondary whitespace-nowrap flex-shrink-0" data-tab="health">Health</button>
                        <button class="tab-btn px-4 py-2 text-sm font-medium border-b-2 border-transparent text-themed-tertiary hover:text-themed-secondary whitespace-nowrap flex-shrink-0" data-tab="discover">Discover</button>
                    </div>
                </div>
            </div>

            <!-- Filter Sidebar Overlay (mobile) -->
            <div id="filter-overlay" class="filter-sidebar-overlay"></div>

            <!-- Main Content with Sidebar -->
            <div class="dashboard-layout mt-6">
                <!-- Filter Sidebar -->
                <aside id="filter-sidebar" class="filter-sidebar collapsed">
                    <div class="filter-sidebar-inner">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-sm font-medium text-themed-secondary">Filters</span>
                            <button id="clear-filters" class="px-2 py-1 text-xs text-themed-secondary hover:text-themed-primary hover:bg-gray-100 dark:hover:bg-gray-700 rounded border border-themed">
                                Clear
                            </button>
                        </div>
                        <div class="filter-group">
                            <div class="filter-group-header">
                                <label>Tag</label>
                                <div class="filter-mode-toggle" data-filter="tag">
                                    <button class="active" data-mode="include" title="Include commits with selected tags">Include</button>
                                    <button class="exclude" data-mode="exclude" title="Exclude commits with selected tags">Exclude</button>
                                </div>
                            </div>
                            <div class="filter-multi-select" id="filter-tag-container">
                                <div class="filter-multi-select-trigger" tabindex="0">
                                    <span class="selected-text">All Tags</span>
                                    <span class="arrow">▾</span>
                                </div>
                                <div class="filter-multi-select-dropdown"></div>
                            </div>
                        </div>
                        <div class="filter-group">
                            <div class="filter-group-header">
                                <label>Author</label>
                                <div class="filter-mode-toggle" data-filter="author">
                                    <button class="active" data-mode="include" title="Include commits by selected authors">Include</button>
                                    <button class="exclude" data-mode="exclude" title="Exclude commits by selected authors">Exclude</button>
                                </div>
                            </div>
                            <div class="filter-multi-select" id="filter-author-container">
                                <div class="filter-multi-select-trigger" tabindex="0">
                                    <span class="selected-text">All Authors</span>
                                    <span class="arrow">▾</span>
                                </div>
                                <div class="filter-multi-select-dropdown"></div>
                            </div>
                        </div>
                        <div class="filter-group" id="repo-filter-container" style="display: none;">
                            <div class="filter-group-header">
                                <label>Repo</label>
                                <div class="filter-mode-toggle" data-filter="repo">
                                    <button class="active" data-mode="include" title="Include commits from selected repos">Include</button>
                                    <button class="exclude" data-mode="exclude" title="Exclude commits from selected repos">Exclude</button>
                                </div>
                            </div>
                            <div class="filter-multi-select" id="filter-repo-multiselect">
                                <div class="filter-multi-select-trigger" tabindex="0">
                                    <span class="selected-text">All Repos</span>
                                    <span class="arrow">▾</span>
                                </div>
                                <div class="filter-multi-select-dropdown"></div>
                            </div>
                        </div>
                        <div class="filter-group">
                            <div class="filter-group-header">
                                <label>Urgency</label>
                                <div class="filter-mode-toggle" data-filter="urgency">
                                    <button class="active" data-mode="include" title="Include commits with selected urgency">Include</button>
                                    <button class="exclude" data-mode="exclude" title="Exclude commits with selected urgency">Exclude</button>
                                </div>
                            </div>
                            <div class="filter-multi-select" id="filter-urgency-container">
                                <div class="filter-multi-select-trigger" tabindex="0">
                                    <span class="selected-text">All Urgency</span>
                                    <span class="arrow">▾</span>
                                </div>
                                <div class="filter-multi-select-dropdown">
                                    <label class="filter-multi-select-option"><input type="checkbox" value="planned"> Planned (1-2)</label>
                                    <label class="filter-multi-select-option"><input type="checkbox" value="normal"> Normal (3)</label>
                                    <label class="filter-multi-select-option"><input type="checkbox" value="reactive"> Reactive (4-5)</label>
                                </div>
                            </div>
                        </div>
                        <div class="filter-group">
                            <div class="filter-group-header">
                                <label>Impact</label>
                                <div class="filter-mode-toggle" data-filter="impact">
                                    <button class="active" data-mode="include" title="Include commits with selected impact">Include</button>
                                    <button class="exclude" data-mode="exclude" title="Exclude commits with selected impact">Exclude</button>
                                </div>
                            </div>
                            <div class="filter-multi-select" id="filter-impact-container">
                                <div class="filter-multi-select-trigger" tabindex="0">
                                    <span class="selected-text">All Impact</span>
                                    <span class="arrow">▾</span>
                                </div>
                                <div class="filter-multi-select-dropdown">
                                    <label class="filter-multi-select-option"><input type="checkbox" value="user-facing"> User-facing</label>
                                    <label class="filter-multi-select-option"><input type="checkbox" value="internal"> Internal</label>
                                    <label class="filter-multi-select-option"><input type="checkbox" value="infrastructure"> Infrastructure</label>
                                    <label class="filter-multi-select-option"><input type="checkbox" value="api"> API</label>
                                </div>
                            </div>
                        </div>
                        <div class="filter-group">
                            <label>From</label>
                            <input type="date" id="filter-date-from" class="filter-input">
                        </div>
                        <div class="filter-group">
                            <label>To</label>
                            <input type="date" id="filter-date-to" class="filter-input">
                        </div>
                        <div class="filter-group">
                            <label>Quick Select</label>
                            <div class="flex flex-wrap gap-1">
                                <button class="filter-preset-btn" data-preset="30days">30 days</button>
                                <button class="filter-preset-btn" data-preset="90days">90 days</button>
                                <button class="filter-preset-btn" data-preset="thisyear">This year</button>
                                <button class="filter-preset-btn" data-preset="lastyear">Last year</button>
                            </div>
                        </div>
                        <div id="filter-indicator" class="hidden mt-3 px-2 py-1 text-xs font-medium bg-blue-100 text-blue-700 rounded text-center"></div>
                    </div>
                </aside>

                <!-- Tab Content Area -->
                <main class="tab-content-area">
                    <div id="tab-overview" class="tab-content">

                <!-- Quick Stats -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-summary-card="features">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">Features Built</p>
                        <p class="text-3xl font-bold text-green-600" id="summary-features">0</p>
                    </div>
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-summary-card="fixes">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">Bugs Fixed</p>
                        <p class="text-3xl font-bold text-amber-600" id="summary-fixes">0</p>
                    </div>
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-summary-card="urgency">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">Avg Urgency</p>
                        <p class="text-3xl font-bold text-themed-primary" id="summary-urgency">-</p>
                    </div>
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-summary-card="planned">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">% Planned</p>
                        <p class="text-3xl font-bold text-green-600" id="summary-planned">0%</p>
                    </div>
                </div>

                <!-- Additional Stats (from global metrics) -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                    <div class="card">
                        <p class="stat-label text-themed-tertiary">Files Changed</p>
                        <p class="text-3xl font-bold text-themed-primary" id="stat-files">0</p>
                        <p class="text-xs text-themed-muted" id="stat-files-sub"></p>
                    </div>
                    <div class="card">
                        <p class="stat-label text-themed-tertiary">Contributors</p>
                        <p class="text-3xl font-bold text-themed-primary" id="stat-contributors">0</p>
                    </div>
                </div>

                <!-- Key Highlights -->
                <div class="mb-6">
                    <div class="card" data-section="highlights">
                        <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                            <div class="collapsible-title">
                                <h3 class="text-lg font-semibold text-themed-primary">Key Highlights</h3>
                            </div>
                            <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div class="collapsible-content">
                            <div id="summary-highlights" class="space-y-3 pt-2"></div>
                        </div>
                    </div>
                </div>

                <!-- Activity Snapshot -->
                <div class="card" data-section="activity-snapshot">
                    <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                        <div class="collapsible-title">
                            <h3 class="text-lg font-semibold text-themed-primary">Activity Snapshot</h3>
                        </div>
                        <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="collapsible-content">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 pt-2" id="summary-activity">
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-activity" class="tab-content hidden">
                <!-- Activity Summary Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-activity-card="total">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">Total Commits</p>
                        <p class="text-3xl font-bold text-themed-primary" id="activity-total-commits">0</p>
                        <p class="text-xs text-themed-muted" id="activity-date-range"></p>
                    </div>
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-activity-card="days">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">Active Days</p>
                        <p class="text-3xl font-bold text-blue-600" id="activity-active-days">0</p>
                        <p class="text-xs text-themed-muted" id="activity-days-sub"></p>
                    </div>
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-activity-card="contributors">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">Contributors</p>
                        <p class="text-3xl font-bold text-green-600" id="activity-contributors">0</p>
                        <p class="text-xs text-themed-muted">active in period</p>
                    </div>
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-activity-card="avg">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">Avg / Day</p>
                        <p class="text-3xl font-bold text-amber-600" id="activity-avg-per-day">0</p>
                        <p class="text-xs text-themed-muted">commits per active day</p>
                    </div>
                </div>

                <!-- Activity Timeline Chart -->
                <div class="card mb-6" data-section="activity-timeline">
                    <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                        <div class="collapsible-title">
                            <h2 class="text-lg font-semibold text-themed-primary">Activity Timeline</h2>
                        </div>
                        <span class="collapsible-subtitle">Commits by date across all projects</span>
                        <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="collapsible-content">
                        <div class="h-48 md:h-64 pt-2">
                            <canvas id="activity-timeline-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Code Changes Over Time Chart -->
                <div class="card mb-6" data-section="code-changes-timeline">
                    <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                        <div class="collapsible-title">
                            <h2 class="text-lg font-semibold text-themed-primary">Code Changes Over Time</h2>
                        </div>
                        <span class="collapsible-subtitle">Lines added/removed by date across all projects</span>
                        <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="collapsible-content">
                        <div class="h-48 md:h-64 pt-2">
                            <canvas id="code-changes-timeline-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card mb-6" data-section="changes-list">
                    <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                        <div class="collapsible-title">
                            <h2 class="text-lg font-semibold text-themed-primary">Changes</h2>
                        </div>
                        <span id="commit-count" class="collapsible-subtitle"></span>
                        <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="collapsible-content">
                        <div id="commit-list" class="space-y-3 max-h-[600px] overflow-y-auto pt-2"></div>
                    </div>
                </div>
            </div>

            <div id="tab-progress" class="tab-content hidden">
                <!-- Work Breakdown Summary Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-work-card="features">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">Features</p>
                        <p class="text-3xl font-bold text-green-600" id="work-features">0</p>
                        <p class="text-xs text-themed-muted">new functionality</p>
                    </div>
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-work-card="bugfixes">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">Bug Fixes</p>
                        <p class="text-3xl font-bold text-red-600" id="work-bugfixes">0</p>
                        <p class="text-xs text-themed-muted">issues resolved</p>
                    </div>
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-work-card="refactors">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">Refactors</p>
                        <p class="text-3xl font-bold text-purple-600" id="work-refactors">0</p>
                        <p class="text-xs text-themed-muted">code improvements</p>
                    </div>
                    <div class="card">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">Avg Complexity</p>
                        <p class="text-3xl font-bold text-themed-primary" id="work-avg-complexity">-</p>
                        <p class="text-xs text-themed-muted">1 (trivial) to 5 (complex)</p>
                    </div>
                </div>

                <div class="card mb-6" data-section="work-type-trend">
                    <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                        <div class="collapsible-title">
                            <h2 class="text-lg font-semibold text-themed-primary">Work Type Trend</h2>
                        </div>
                        <span class="collapsible-subtitle">Features vs bug fixes over time</span>
                        <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="collapsible-content">
                        <div class="h-64 pt-2">
                            <canvas id="feat-fix-chart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="card mb-6" data-section="complexity-trend">
                    <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                        <div class="collapsible-title">
                            <h2 class="text-lg font-semibold text-themed-primary">Complexity Over Time</h2>
                        </div>
                        <span class="collapsible-subtitle">Average complexity by month</span>
                        <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="collapsible-content">
                        <div class="h-64 pt-2">
                            <canvas id="complexity-trend-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-contributors" class="tab-content hidden">
                <div class="card mb-6" data-section="who-does-what">
                    <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                        <div class="collapsible-title">
                            <h2 class="text-lg font-semibold text-themed-primary">Who Does What</h2>
                        </div>
                        <span class="collapsible-subtitle">Work type distribution by contributor</span>
                        <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="collapsible-content">
                        <div id="contributor-work-types" class="space-y-4 pt-2"></div>
                    </div>
                </div>
                <div class="card mb-6" data-section="complexity-by-contributor">
                    <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                        <div class="collapsible-title">
                            <h2 class="text-lg font-semibold text-themed-primary">Complexity by Contributor</h2>
                        </div>
                        <span class="collapsible-subtitle">Who handles complex vs simple changes</span>
                        <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="collapsible-content">
                        <div class="h-64 pt-2">
                            <canvas id="contributor-complexity-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-security" class="tab-content hidden">
                <!-- Operational Health Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-health-card="security">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">Security</p>
                        <p class="text-3xl font-bold text-red-600" id="health-security-count">0</p>
                        <p class="text-xs text-themed-muted">security commits</p>
                    </div>
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-health-card="reactive">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">Reactive</p>
                        <p class="text-3xl font-bold text-amber-600" id="health-reactive-pct">0%</p>
                        <p class="text-xs text-themed-muted">urgency 4-5</p>
                    </div>
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-health-card="weekend">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">Weekend</p>
                        <p class="text-3xl font-bold text-indigo-600" id="health-weekend-pct">0%</p>
                        <p class="text-xs text-themed-muted">Sat/Sun commits</p>
                    </div>
                    <div class="card cursor-pointer hover:shadow-md transition-shadow" data-health-card="afterhours">
                        <p class="text-sm text-themed-tertiary uppercase tracking-wide">After Hours</p>
                        <p class="text-3xl font-bold text-purple-600" id="health-afterhours-pct">0%</p>
                        <p class="text-xs text-themed-muted">outside work hours</p>
                    </div>
                </div>

                <!-- Security Commits -->
                <div class="card mb-6" data-section="security-commits">
                    <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                        <div class="collapsible-title">
                            <h2 class="text-lg font-semibold text-themed-primary">Security-Related Commits</h2>
                        </div>
                        <span class="collapsible-subtitle">Security-tagged commits</span>
                        <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="collapsible-content">
                        <div id="security-list" class="space-y-3 pt-2"></div>
                    </div>
                </div>

                <!-- Urgency Distribution -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="card" data-section="urgency-distribution">
                        <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                            <div class="collapsible-title">
                                <h2 class="text-lg font-semibold text-themed-primary">Urgency Distribution</h2>
                            </div>
                            <span class="collapsible-subtitle">Planned vs Normal vs Reactive</span>
                            <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div class="collapsible-content">
                            <div id="urgency-breakdown" class="space-y-3 pt-2"></div>
                        </div>
                    </div>
                    <div class="card" data-section="impact-distribution">
                        <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                            <div class="collapsible-title">
                                <h2 class="text-lg font-semibold text-themed-primary">Impact Distribution</h2>
                            </div>
                            <span class="collapsible-subtitle">Where effort is directed</span>
                            <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div class="collapsible-content">
                            <div id="impact-breakdown" class="space-y-3 pt-2"></div>
                        </div>
                    </div>
                </div>

                <!-- Trend Charts -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="card" data-section="urgency-trend">
                        <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                            <div class="collapsible-title">
                                <h2 class="text-lg font-semibold text-themed-primary">Urgency Trend</h2>
                            </div>
                            <span class="collapsible-subtitle">Avg urgency by month (lower is better)</span>
                            <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div class="collapsible-content">
                            <div class="h-48 pt-2">
                                <canvas id="urgency-trend-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="card" data-section="impact-trend">
                        <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                            <div class="collapsible-title">
                                <h2 class="text-lg font-semibold text-themed-primary">Impact Over Time</h2>
                            </div>
                            <span class="collapsible-subtitle">Impact categories by month</span>
                            <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div class="collapsible-content">
                            <div class="h-48 pt-2">
                                <canvas id="impact-trend-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contributor Health -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="card" data-section="urgency-by-contributor">
                        <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                            <div class="collapsible-title">
                                <h2 class="text-lg font-semibold text-themed-primary">Urgency by Contributor</h2>
                            </div>
                            <span class="collapsible-subtitle">Reactive vs planned work</span>
                            <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div class="collapsible-content">
                            <div id="urgency-by-contributor" class="space-y-3 pt-2"></div>
                        </div>
                    </div>
                    <div class="card" data-section="impact-by-contributor">
                        <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                            <div class="collapsible-title">
                                <h2 class="text-lg font-semibold text-themed-primary">Impact by Contributor</h2>
                            </div>
                            <span class="collapsible-subtitle">Where each person's effort goes</span>
                            <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div class="collapsible-content">
                            <div id="impact-by-contributor" class="space-y-3 pt-2"></div>
                        </div>
                    </div>
                </div>

            </div>

            <div id="tab-tags" class="tab-content hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="card" data-section="commits-by-tag">
                        <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                            <div class="collapsible-title">
                                <h2 class="text-lg font-semibold text-themed-primary">Commits by Tag</h2>
                            </div>
                            <span class="collapsible-subtitle">Multiple tags per commit</span>
                            <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div class="collapsible-content">
                            <div class="h-80 pt-2">
                                <canvas id="tags-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="card" data-section="tag-breakdown">
                        <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                            <div class="collapsible-title">
                                <h2 class="text-lg font-semibold text-themed-primary">Tag Breakdown</h2>
                            </div>
                            <span class="collapsible-subtitle">Tag occurrences</span>
                            <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div class="collapsible-content">
                            <div id="tag-breakdown" class="space-y-2 pt-2"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-timing" class="tab-content hidden">
                <div class="card mb-6">
                    <div>
                        <h2 class="text-lg font-semibold text-themed-primary">When Work Happens</h2>
                        <p class="text-xs text-themed-tertiary">Commit distribution by time of day and day of week</p>
                    </div>
                </div>

                <!-- Heatmap -->
                <div class="card mb-6" data-section="activity-heatmap">
                    <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                        <div class="collapsible-title">
                            <h2 class="text-lg font-semibold text-themed-primary">Activity Heatmap</h2>
                        </div>
                        <span class="collapsible-subtitle">Hour × day of week</span>
                        <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="collapsible-content">
                        <div id="heatmap-container" class="overflow-x-auto pt-2">
                            <div id="heatmap" class="heatmap-grid"></div>
                        </div>
                        <div class="flex items-center justify-center gap-2 mt-4 text-xs text-themed-tertiary">
                            <span>Less</span>
                            <div class="flex gap-0.5">
                                <div class="w-4 h-4 rounded heatmap-0"></div>
                                <div class="w-4 h-4 rounded heatmap-1"></div>
                                <div class="w-4 h-4 rounded heatmap-2"></div>
                                <div class="w-4 h-4 rounded heatmap-3"></div>
                                <div class="w-4 h-4 rounded heatmap-4"></div>
                            </div>
                            <span>More</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="card" data-section="commits-by-hour">
                        <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                            <div class="collapsible-title">
                                <h2 class="text-lg font-semibold text-themed-primary">Commits by Hour of Day</h2>
                            </div>
                            <span class="collapsible-subtitle">24-hour distribution</span>
                            <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div class="collapsible-content">
                            <div class="h-64 pt-2">
                                <canvas id="hour-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="card" data-section="commits-by-day">
                        <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                            <div class="collapsible-title">
                                <h2 class="text-lg font-semibold text-themed-primary">Commits by Day of Week</h2>
                            </div>
                            <span class="collapsible-subtitle">Weekly distribution</span>
                            <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div class="collapsible-content">
                            <div class="h-64 pt-2">
                                <canvas id="day-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Developer Activity Patterns -->
                <div class="card mb-6" data-section="developer-patterns">
                    <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                        <div class="collapsible-title">
                            <h2 class="text-lg font-semibold text-themed-primary">Developer Activity Patterns</h2>
                        </div>
                        <span class="collapsible-subtitle">When each contributor commits</span>
                        <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="collapsible-content">
                        <div id="developer-patterns" class="space-y-4 pt-2"></div>
                    </div>
                </div>
            </div>

            <!-- Discover Tab -->
            <div id="tab-discover" class="tab-content hidden">
                <!-- Shuffle Controls -->
                <div class="flex items-center justify-between mb-6">
                    <p class="text-sm text-themed-tertiary">Explore different metrics. Shuffle for variety or pin your favorites.</p>
                    <button id="shuffle-metrics" class="px-4 py-2 text-sm font-medium bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                        Shuffle
                    </button>
                </div>

                <!-- Metric Cards Grid -->
                <div id="discover-metrics" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <!-- Cards will be dynamically generated -->
                </div>

                <!-- File Insights Section -->
                <div class="card mb-6" data-section="file-insights">
                    <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                        <div class="collapsible-title">
                            <h3 class="text-lg font-semibold text-themed-primary">File Activity</h3>
                        </div>
                        <span class="collapsible-subtitle">Most active files (anonymized)</span>
                        <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="collapsible-content">
                        <div id="file-insights" class="space-y-3 pt-2"></div>
                    </div>
                </div>

                <!-- Comparisons Section -->
                <div class="card" data-section="comparisons">
                    <div class="collapsible-header" aria-expanded="false" onclick="toggleSection(this)">
                        <div class="collapsible-title">
                            <h3 class="text-lg font-semibold text-themed-primary">Comparisons</h3>
                        </div>
                        <span class="collapsible-subtitle">Data comparisons</span>
                        <svg class="collapsible-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="collapsible-content">
                        <div id="discover-comparisons" class="space-y-3 pt-2"></div>
                    </div>
                </div>
            </div>
                </main>
            </div>

            <!-- Dashboard Footer -->
            <footer id="dashboard-footer" class="mt-8 pt-6 pb-8 border-t border-themed text-center text-sm text-themed-tertiary">
                <span id="footer-summary">Loading...</span>
            </footer>
        </div>

        <!-- Detail Pane (slide-out panel for drill-down) -->
        <div id="detail-overlay" class="detail-pane-overlay"></div>
        <div id="detail-pane" class="detail-pane">
            <div class="detail-pane-header">
                <div>
                    <div class="detail-pane-title" id="detail-title">Details</div>
                    <div class="detail-pane-subtitle" id="detail-subtitle"></div>
                </div>
                <button class="detail-pane-close" id="detail-close" title="Close panel">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="detail-pane-content" id="detail-content">
                <div class="detail-pane-loading">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>

        <!-- Settings Panel (slide-out panel for configuration) -->
        <div id="settings-overlay" class="settings-pane-overlay"></div>
        <div id="settings-pane" class="settings-pane">
            <div class="settings-pane-header">
                <div class="settings-pane-title">Settings</div>
                <button class="settings-pane-close" id="settings-close" title="Close settings">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="settings-pane-content">
                <!-- View Settings -->
                <div class="settings-section">
                    <div class="settings-section-title">View</div>
                    <div class="settings-group">
                        <label>View Level</label>
                        <select id="settings-view-level" class="filter-select">
                            <option value="developer">Developer</option>
                            <option value="management">Management</option>
                            <option value="executive">Executive</option>
                        </select>
                        <p class="settings-hint">Controls data granularity across all views</p>
                    </div>
                    <div class="settings-group" style="margin-top: 16px;">
                        <div class="settings-toggle" id="settings-privacy-toggle">
                            <div>
                                <div class="settings-toggle-label">Privacy Mode</div>
                                <div class="settings-toggle-hint">Hide names and commit messages</div>
                            </div>
                            <div class="settings-toggle-switch"></div>
                        </div>
                    </div>
                </div>

                <!-- Time Settings -->
                <div class="settings-section">
                    <div class="settings-section-title">Time</div>
                    <div class="settings-group">
                        <label>Timezone</label>
                        <select id="settings-timezone" class="filter-select">
                            <option value="local">Local</option>
                            <option value="utc">UTC</option>
                        </select>
                    </div>
                    <div class="settings-row" style="margin-top: 16px;">
                        <div class="settings-group">
                            <label>Work Hours Start</label>
                            <select id="settings-work-start" class="filter-select">
                                <option value="6">6:00</option>
                                <option value="7">7:00</option>
                                <option value="8" selected>8:00</option>
                                <option value="9">9:00</option>
                                <option value="10">10:00</option>
                            </select>
                        </div>
                        <div class="settings-group">
                            <label>Work Hours End</label>
                            <select id="settings-work-end" class="filter-select">
                                <option value="16">16:00</option>
                                <option value="17" selected>17:00</option>
                                <option value="18">18:00</option>
                                <option value="19">19:00</option>
                                <option value="20">20:00</option>
                            </select>
                        </div>
                    </div>
                    <p class="settings-hint" style="margin-top: 8px;">Defines what counts as "work hours" for timing analysis</p>
                </div>

                <!-- PWA Install Section -->
                <div class="settings-section" id="pwa-settings-section">
                    <div class="settings-section-title">Install App</div>
                    <div class="settings-group">
                        <p class="settings-hint" style="margin-bottom: 12px;">
                            Install this dashboard as an app for offline access and a native experience.
                        </p>
                        <button id="btn-pwa-install-settings" class="btn-primary" style="width: 100%; padding: 10px;" onclick="installPWA()">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 6px;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                            </svg>
                            Install Dashboard
                        </button>
                        <p id="pwa-status-text" class="settings-hint" style="margin-top: 8px; text-align: center;"></p>
                    </div>
                    <div class="settings-group" style="margin-top: 12px;">
                        <details style="font-size: 12px; color: var(--text-secondary);">
                            <summary style="cursor: pointer; font-weight: 500;">How to install manually</summary>
                            <div style="margin-top: 8px; padding-left: 8px; border-left: 2px solid var(--border-color);">
                                <p style="margin-bottom: 6px;"><strong>Chrome/Edge:</strong> Click the install icon in the address bar, or Menu &rarr; "Install app"</p>
                                <p style="margin-bottom: 6px;"><strong>Safari (iOS):</strong> Tap Share &rarr; "Add to Home Screen"</p>
                                <p><strong>Firefox:</strong> Menu &rarr; "Install" (if available)</p>
                            </div>
                        </details>
                    </div>
                    <div class="settings-group" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                        <div class="settings-section-title" style="font-size: 13px;">Updates</div>
                        <p class="settings-hint" style="margin-bottom: 8px;">
                            The app updates automatically in the background. Close and reopen to apply any pending update.
                        </p>
                        <button id="btn-pwa-check-update" class="btn-secondary" style="width: 100%; padding: 8px; font-size: 12px; border-radius: var(--radius-sm); cursor: pointer;" onclick="checkForUpdate()">
                            Check for Updates
                        </button>
                        <p id="pwa-update-status" class="settings-hint" style="margin-top: 6px; text-align: center; font-size: 11px;"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>
    <div id="heatmap-tooltip" class="heatmap-tooltip" aria-hidden="true"></div>


    <script type="module" src="./js/main.js"></script>
</body>
</html>
